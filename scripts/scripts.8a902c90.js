"use strict";var app=angular.module("F1App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angularVideoBg","timer"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"RaceController"}).when("/race/:season/:round",{templateUrl:"views/raceDetail.html",controller:"SingleRaceController"}).when("/drivers",{templateUrl:"views/driverList.html",controller:"DriversController"}).when("/drivers/:id",{templateUrl:"views/driverDetail.html",controller:"DriverController"}).when("/circuits",{templateUrl:"views/circuitList.html",controller:"CircuitsController"}).when("/circuits/:id",{templateUrl:"views/circuitDetail.html",controller:"CircuitController"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/"})}]);app.filter("limitHtml",function(){return function(a,b){var c=String(a).replace(/<[^>]+>/gm,""),d=c.length;return d>b?c.substr(0,b-1):c}}),app.filter("prettyJSON",function(){function a(a){return JSON?JSON.stringify(a,null,"  "):"your browser doesnt support JSON so cant pretty print"}return a}),app.controller("NavController",["$scope","$location","$window",function(a,b,c){a.isCollapsed=!0,a.$on("$routeChangeSuccess",function(){a.isCollapsed=!0}),a.isActive=function(a){var c=a===b.path();return c},angular.element(c).bind("scroll",function(){window.pageYOffset>85?(a.navClass="header-sm",a.logoClass="logo-sm"):(a.navClass="header-lg",a.logoClass="logo-lg"),a.$apply()})}]),app.controller("RaceController",["$scope","ergastAPIservice",function(a,b){a.raceFilter="",a.nextRace={},a.raceResults=[],a.pageClass="page-main",a.searchFilter=function(b){var c=new RegExp(a.raceFilter,"i");return!a.raceFilter||c.test(b.raceName)},a.getRaceResults=function(c){a.raceseason=c,b.getRaceResults(c).success(function(b){a.raceResults=b.MRData.RaceTable.Races.reverse()})},a.getNextRace=function(){b.getNextRace().success(function(b){var c=b.MRData.RaceTable.Races[0].date,d=b.MRData.RaceTable.Races[0].time;a.countdown=moment.utc(c+" "+d),a.nextRace=b.MRData.RaceTable.Races[0]})},a.clearFilter=function(){a.raceFilter=""},a.hover=function(b){a.hoverMsg="View results for "+b.season+" "+b.raceName,this.hovering=!this.hovering}}]),app.controller("SingleRaceController",["$scope","$filter","$routeParams","ergastAPIservice","Flickr",function(a,b,c,d,e){a.season=c.season,a.round=c.round,a.photos=[],a.pageClass="page-race-result",d.getRaceResult(a.season,a.round).success(function(b){a.raceResult=b.MRData.RaceTable.Races[0],a.getRacePhotos(a.raceResult.Results[0].Driver.givenName+" "+a.raceResult.Results[0].Driver.familyName+" "+a.raceResult.season+" "+a.raceResult.raceName)}),a.getRacePhotos=function(b){e.getFlickrPhoto(b).then(function(b){a.photos=b.data.photos.photo})}}]),app.controller("DriversController",["$scope","$http","ergastAPIservice",function(a,b,c){a.drivers=[],c.getDrivers().success(function(b){a.drivers=b.MRData.StandingsTable.StandingsLists[0].DriverStandings})}]),app.controller("DriverController",["$scope","$http","$routeParams","$filter","ergastAPIservice","wikiService","Flickr",function(a,b,c,d,e,f,g){a.nameFilter=null,a.id=c.id;var h="";e.getDriver(a.id).success(function(b){a.driver=b.MRData.StandingsTable.StandingsLists[0].DriverStandings[0].Driver,h=a.driver.givenName+"_"+a.driver.familyName,a.driverBio(h),a.getDriverPhoto(h)}),a.driverBio=function(b){f.get(b).then(function(b){var c=b.data.query.pageids[0];a.wikiData=b.data.query.pages[c].extract,a.wikiUrl=b.data.query.pages[c].canonicalurl})},a.getDriverPhoto=function(b){g.getFlickrPhoto(b).then(function(b){a.photo=b.data.photos.photo[0]})}}]),app.controller("CircuitsController",["$scope","$http","ergastAPIservice",function(a,b,c){a.circuits=[],c.getCircuits().success(function(b){a.circuits=b.MRData.CircuitTable.Circuits,console.log(a.circuits)})}]),app.controller("CircuitController",["$scope","$routeParams","$filter","$http","ergastAPIservice","wikiService",function(a,b,c,d,e,f){a.circuit={},a.id=b.id,e.getCircuit(a.id).success(function(b){a.circuit=b.MRData.CircuitTable.Circuits[0],a.Area={Name:a.circuit.Location.locality,Latitude:a.circuit.Location.lat,Longitude:a.circuit.Location["long"]};var d=a.circuit.circuitName;f.get(d).success(function(b){var d=b.query.pageids[0];a.circuitInfo=c("limitTo")(b.query.pages[d].extract,2500),a.wikiUrl=b.query.pages[d].canonicalurl})})}]),app.controller("VideoBkgController",["$scope",function(a){a.videoId="5emilZhzI70",a.callback=function(b){a.pauseVideo=function(){b.pauseVideo()},a.playVideo=function(){b.playVideo()},a.setQuality=function(a){a=void 0===a?"default":a,b.setPlaybackQuality(a)},a.setQuality()}}]),app.factory("ergastAPIservice",["$http",function(a){var b={};return b.getRaceResults=function(b){return b=void 0===b?"current":b,a({method:"JSONP",url:"http://ergast.com/api/f1/"+b+"/results/1.json?callback=JSON_CALLBACK",cache:!0})},b.getRaceResult=function(b,c){return a({method:"JSONP",url:"http://ergast.com/api/f1/"+b+"/"+c+"/results.json?callback=JSON_CALLBACK",cache:!0})},b.getNextRace=function(){return a({method:"JSONP",url:"http://ergast.com/api/f1/current/next.json?callback=JSON_CALLBACK"})},b.getDrivers=function(){return a({method:"JSONP",url:"http://ergast.com/api/f1/current/driverStandings.json?callback=JSON_CALLBACK",cache:!0})},b.getDriver=function(b){return a({method:"JSONP",url:"http://ergast.com/api/f1/current/drivers/"+b+"/driverStandings.json?callback=JSON_CALLBACK",cache:!0})},b.getDriverStandings=function(b){return a({method:"JSONP",url:"http://ergast.com/api/f1/drivers/"+b+"/driverStandings.json?callback=JSON_CALLBACK",cache:!0})},b.getCircuits=function(){return a({method:"JSONP",url:"http://ergast.com/api/f1/current/circuits.json?callback=JSON_CALLBACK",cache:!0})},b.getCircuit=function(b){return a({method:"JSONP",url:"http://ergast.com/api/f1/circuits/"+b+".json?callback=JSON_CALLBACK",cache:!0})},b}]),app.factory("wikiService",["$http",function(a){var b={get:function(b){return a.jsonp("http://en.wikipedia.org/w/api.php?titles="+b+"&rawcontinue=true&action=query&format=json&prop=extracts|info&inprop=url&indexpageids&redirects&callback=JSON_CALLBACK")}};return b}]),app.factory("Flickr",["$http",function(a){var b="https://api.flickr.com/services",c="134a9fcc3efe82d2db0a296282a176f6";this.setApiKey=function(a){c=a||c};var d={getFlickrPhoto:function(d){return a({method:"JSONP",url:b+"/rest/?method=flickr.photos.search&api_key="+c+"&text="+d,params:{sort:"relevance",per_page:5,tag_mode:"all",format:"json",jsoncallback:"JSON_CALLBACK"}})}};return d}]),app.directive("addressBasedGoogleMap",function(){return{restrict:"A",template:"<div id='addressMap'></div>",scope:{address:"=",zoom:"=",type:"="},controller:["$scope",function(a){var b,c,d,e,f=function(){b=new google.maps.Geocoder,c=new google.maps.LatLng(-34.397,150.644);var e="SATELLITE"===type.toUpperCase()?google.maps.MapTypeId.SATELLITE:google.maps.MapTypeId.TERRAIN,f={zoom:a.zoom,center:c,mapTypeId:e};d=new google.maps.Map(document.getElementById("addressMap"),f)},g=function(){b.geocode({address:a.address},function(a,b){b==google.maps.GeocoderStatus.OK&&(d.setCenter(a[0].geometry.location),e=new google.maps.Marker({map:d,position:a[0].geometry.location}))})};a.$watch("address",function(){void 0!=a.address&&g()}),f()}]}}),app.directive("areaBasedGoogleMap",function(){return{restrict:"A",template:"<div id='areaMap'></div>",scope:{area:"=",zoom:"=",mapview:"@"},controller:["$scope",function(a){var b,c,d,e=function(){b={zoom:a.zoom,center:new google.maps.LatLng(40,-98),mapTypeId:"satellite"==a.mapview?google.maps.MapTypeId.SATELLITE:google.maps.MapTypeId.TERRAIN},c=new google.maps.Map(document.getElementById("areaMap"),b)},f=function(a){var b=new google.maps.LatLng(a.Latitude,a.Longitude);c.setCenter(b),d=new google.maps.Marker({map:c,position:b,title:a.Name})};a.$watch("area",function(a){void 0!=a&&f(a)}),e()}]}}),app.directive("routeLoadingIndicator",["$rootScope",function(a){return{restrict:"E",template:'<div ng-class="route-loader" ng-if="isRouteLoading">Loading...</div>',link:function(b,c,d){b.isRouteLoading=!1,a.$on("$routeChangeStart",function(){b.isRouteLoading=!0}),a.$on("$routeChangeSuccess",function(){b.isRouteLoading=!1})}}}]);