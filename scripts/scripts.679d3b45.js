"use strict";var app=angular.module("F1App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","timer"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"RaceController"}).when("/race/:season/:round",{templateUrl:"views/raceDetail.html",controller:"SingleRaceController"}).when("/driver/:id",{templateUrl:"views/driverDetail.html",controller:"DriverController"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/"})}]);app.controller("NavController",["$scope","$location",function(a,b){a.isActive=function(a){var c=a===b.path();return c}}]),app.controller("RaceController",["$scope","ergastAPIservice",function(a,b){a.raceFilter="",a.nextRace={},a.raceResults=[],a.pageClass="page-main",a.searchFilter=function(b){var c=new RegExp(a.raceFilter,"i");return!a.raceFilter||c.test(b.raceName)},a.getRaceResults=function(c){a.raceseason=c,b.getRaceResults(c).success(function(b){a.raceResults=b.MRData.RaceTable.Races.reverse(),console.log(a.raceResults)})},b.getNextRace().success(function(b){var c=b.MRData.RaceTable.Races[0].date,d=b.MRData.RaceTable.Races[0].time;a.countdown=moment.utc(c+" "+d),a.nextRace=b.MRData.RaceTable.Races[0]}),a.clearFilter=function(){a.raceFilter=""}}]),app.controller("SingleRaceController",["$scope","$routeParams","ergastAPIservice","Flickr",function(a,b,c,d){a.season=b.season,a.round=b.round,a.pageClass="page-race-result",c.getRaceResult(a.season,a.round).success(function(b){a.raceResult=b.MRData.RaceTable.Races[0],a.getRacePhotos(a.raceResult.Results[0].Driver.givenName+" "+a.raceResult.Results[0].Driver.familyName+" "+a.raceResult.season+" "+a.raceResult.raceName),console.log(a.raceResult)}),a.getRacePhotos=function(b){d.getFlickrPhoto(b).then(function(b){a.photos=b.data.photos.photo})}}]),app.controller("DriverController",["$scope","$http","$routeParams","ergastAPIservice","wikiService","Flickr",function(a,b,c,d,e,f){a.nameFilter=null,a.driversList=[],a.id=c.id;var g="";d.getDriver(a.id).success(function(b){a.driver=b.MRData.DriverTable.Drivers[0],g=a.driver.givenName+"_"+a.driver.familyName,a.driverBio(g),a.getDriverPhoto(g)}),a.driverBio=function(b){e.get(b).then(function(b){console.log(b);var c=b.data.query.pageids[0];a.wikiData=b.data.query.pages[c].extract})},a.getDriverPhoto=function(b){f.getFlickrPhoto(b).then(function(b){a.photo=b.data.photos.photo[0],console.log(a.photo)})}}]),app.factory("ergastAPIservice",["$http",function(a){var b={};return b.getRaceResults=function(b){return void 0===b&&(b="current"),a({method:"JSONP",url:"http://ergast.com/api/f1/"+b+"/results/1.json?callback=JSON_CALLBACK"})},b.getRaceResult=function(b,c){return a({method:"JSONP",url:"http://ergast.com/api/f1/"+b+"/"+c+"/results.json?callback=JSON_CALLBACK"})},b.getNextRace=function(){return a({method:"JSONP",url:"http://ergast.com/api/f1/current/next.json?callback=JSON_CALLBACK"})},b.getDriver=function(b){return a({method:"JSONP",url:"http://ergast.com/api/f1/drivers/"+b+".json?callback=JSON_CALLBACK"})},b}]),app.factory("wikiService",["$http",function(a){var b={get:function(b){return a.jsonp("http://en.wikipedia.org/w/api.php?titles="+b+"&rawcontinue=true&action=query&format=json&prop=extracts&indexpageids&callback=JSON_CALLBACK")}};return b}]),app.factory("Flickr",["$http",function(a){var b="https://api.flickr.com/services",c="134a9fcc3efe82d2db0a296282a176f6";this.setApiKey=function(a){c=a||c};var d={getFlickrPhoto:function(d){return a({method:"JSONP",url:b+"/rest/?method=flickr.photos.search&api_key="+c+"&text="+d,params:{sort:"relevance",per_page:5,tag_mode:"all",format:"json",jsoncallback:"JSON_CALLBACK"}})}};return d}]),app.directive("addressBasedGoogleMap",function(){return{restrict:"A",template:"<div id='addressMap'></div>",scope:{address:"=",zoom:"="},controller:["$scope",function(a){var b,c,d,e,f=function(){b=new google.maps.Geocoder,c=new google.maps.LatLng(-34.397,150.644);var e={zoom:a.zoom,center:c,mapTypeId:google.maps.MapTypeId.ROADMAP};d=new google.maps.Map(document.getElementById("addressMap"),e)},g=function(){b.geocode({address:a.address},function(a,b){b==google.maps.GeocoderStatus.OK&&(d.setCenter(a[0].geometry.location),e=new google.maps.Marker({map:d,position:a[0].geometry.location}))})};a.$watch("address",function(){void 0!=a.address&&g()}),f()}]}}),app.directive("areaBasedGoogleMap",function(){return{restrict:"A",template:"<div id='areaMap'></div>",scope:{area:"=",zoom:"="},controller:["$scope",function(a){var b,c,d,e=function(){b={zoom:a.zoom,center:new google.maps.LatLng(40,-98),mapTypeId:google.maps.MapTypeId.TERRAIN},c=new google.maps.Map(document.getElementById("areaMap"),b)},f=function(a){var b=new google.maps.LatLng(a.Latitude,a.Longitude);c.setCenter(b),d=new google.maps.Marker({map:c,position:b,title:a.Name})};a.$watch("area",function(a){void 0!=a&&f(a)}),e()}]}});